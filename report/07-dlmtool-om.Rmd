# THE DLMTOOL OPERATING MODEL

<!-- *A summary of the important features of the DLMtool operating model* -->

<!-- *Draw on appendix of DLMtool paper but simplified to have one region* -->

<!-- *Not too many details; reference the paper* -->

The full operating model with many parameters varying by year, multiple subareas, and additional possible parameterizations is described in the appendices of @carruthers2018. Here we summarize a simplified version that represents a model sufficiently complex to represent most base models in the framework. In particular, we don't express parameters as varying through time where we have recommended that they be treated as fixed through time as provisional starting points. Wherever possible, we follow the notation conventions used in @carruthers2018 for consistency.

# POPULATION DYNAMICS MODEL

<!-- Last historical year, the ``current'' year is denoted by $c$. -->

The DLMtool population dynamics model is at its core a classical age-structured model. The numbers of fish $N$ in consecutive years $y$ are
calculated from those from the previous year and age class $a$,
subject to the instantaneous mortality rate $Z$:

$$
N_{y + 1,a + 1} = N_{a}e^{- Z_{a}} . 
$$


Fish older than the maximum age $n_a$ are assumed to die. Total mortality rate $Z$ is the sum of natural mortality ($M$) and fishing mortality ($F$) rates:

$$
Z_{a} = M + F_{a}.
$$

Fishing mortality rate ($F$) calculations are included in TODO.

The operating model assumes that growth follows a von Bertalanffy model:

$$
L_{y,a} = L_{\infty}\left( 1 - \exp( - \kappa(a - t_{0} \right)),
$$

where ${\kappa}$ represents the growth rate, $L_{\infty}$ represents the maximum length and $t_0$ represents the theoretical age where length is zero.

The operating model specifies maturity according to length
and a logistic model with parameters for the length at 50% maturity ($\theta_{l50}$) and the length increment to 95% maturity ($\theta_{l50-95}$). Maturity-at-length ($m_l$) is then calculated as:

$$
m_{l} = \frac{1}{1 + e^{{- \ln}19\left( \frac{l - \mathrm{\Delta}_{l50} \cdot L_{\infty}}{{{\theta}}_{l50-95}} \right)}},
$$

and maturity-at-age is calculated using the length-at-age:

$$
m_{a} = \frac{1}{1 + e^{{- \ln}19\left( \frac{a - \theta_{a50}}{\theta_{a95} - \theta_{a50}} \right)}}
$$

where \(\theta_{a50}\) and \(\theta_{a95}\) represent the age at 50% and 95% vulnerability given by the inverse von-Bertalanffy growth curve:

$$
\theta_{a50} = \frac{- \ln\left( 1 - \mathrm{\Delta}_{l50} \right)}{\kappa} + t_{0}
$$

$$
\theta_{a95} = \frac{- \ln\left( 1 - \left( \mathrm{\Delta}_{l50} + \frac{{{\theta}}_{l50\_ 95}}{L_{\infty}} \right) \right)}{\kappa} + t_{0}
$$
The number of fish recruited to the first age group each year $N_{y,a=1}$
is calculated using a Beverton-Holt stock-recruitment relationship with
lognormal recruitment deviations $\varepsilon_{R,y}$ (Table App.
C.2):

$$
N_{y + 1, a = 1} = \left( \frac{4 {h} R_{0,r} S_{y,r}} {S_{0,r}  \left( 1 - {h} \right) + \left( 5{h} - 1 \right) S_{y,r}} \right) \cdot \varepsilon_{R,y},
$$

where the spawning biomass $S$ in a given year is the
sum of the spawning biomass over ages of the maturity at age $m_a$, weight at age
$W_a$, and numbers at age $N_{y,a}$:

$$
S_{y} = \sum_{a = 1}^{n_{a}}{m_{a}W_{a}N_{y,a}}.
$$

Unfished spawning biomass
\(S_{0}\) is calculated from unfished recruitment
\({{R}}_{0}\) and survival to age $a$:

$$
S_{0} = \sum_{a = 1}^{n_{a}}{m_{a}\ W_{a}{\ {R}}_{0}\ e^{\sum_{i = 1}^{a}M_{i}}}.
$$

Weight-at-age ($W_a$) is then assumed to be related to length by:

$$
W_{y,a} = \beta_{W}\ {L_{a}}^{\alpha_{W}}.
$$

The recruitment deviations are generated by first sampling from a lognormal distribution with mean $1$ and standard deviation \({{\sigma}}_{R}\):

$$
{\dot{\varepsilon}}_{R,y}\sim \mathrm{Lognormal}\left( 1,{{\sigma}}_{R} \right),
$$

and to these initial draws ($\dot{\varepsilon}_{R,y}$), temporal autocorrelation is added as:

$$
{\widehat{\varepsilon}}_{R,y} = {{\theta}}_{\text{AC}}{\ \dot{\varepsilon}}_{R,y - 1} + {\ \dot{\varepsilon}}_{R,y}\sqrt{\left( 1 - {{{\theta}}_{\text{AC}}}^{2} \right)},
$$

where  $\theta_{\text{AC}}$ represents a first-order autocorrelation term.

Numbers at age are initialized in the first historical year using unfinished recruitment \({{R}}_{0}\) as:

$$
N_{1,a} = {{R}}_{0}\ e^{\sum_{i = 1}^{a}M_{i}}\ \cdot \varepsilon_{R,y - a}.
$$
