\clearpage

# REX SOLE CASE STUDY {#app:mse-rex}

```{r rex-mps, results='asis'}
mp <- readr::read_csv(here::here("data", "mp.txt"), comment = "#")
mp_list <- split(mp, mp$type)
csasdown::csas_table(mp, caption = "MPs")
```

West Coast Vancouver Island Rex Sole
  
The performance metrics are defined as:

1. LT P40: Probability SB > 0.4 SB~MSY~ (years 36--50)
1. LT P80: Probability SB > 0.8 SB~MSY~ (years 36--50)
1. PNOF: Probability of not overfishing P(F < F~FMSY~) (years 1--50)
1. LTY: Probability yield > 0.5 MSY (years 36--50)
1. STY: Probability yield > 0.5 MSY (years 6--20)
1. AAVY: Probability AAVY (average annual variability in yield) < 0.2 (years 1--50)

where SB is spawning biomass.

## BACKGROUND

Rex sole (*Glyptocephalus zachirus*) occur from central Baja California to the western Bering Sea, and are generally distributed throughout coastal BC [@mecklenburg2002]. They have been caught in BC at depths between 20 m and greater than 1000 m, with most captured between 75 m and 450 m.

Rex sole have been caught in BC waters as large as 58 cm and up to 1.44 kg. The only aged rex sole from BC are those caught in the Hecate Strait Multispecies Assemblage Bottom Trawl survey in 1998. The oldest rex sole aged from BC was a 34 cm female aged at 15 years, though larger, unaged individuals have been caught up to length 58 cm. This species has been aged up to 29 years (female) in the Gulf of Alaska [@abookire2006]. Additional otoliths have been collected on BC surveys from 2000-present although they have yet to be aged.

### History of fishery

Rex sole is a commonly caught flatfish species in BC groundfish bottom trawl surveys and although it is commonly caught in the commercial mixed-species bottom trawl fishery, there is no directed fishery or assigned quota for it. Rex sole have never been formally assessed in BC; however, biomass of rex sole in Hecate Strait was estimated in 2012 using research survey data collected between 1984 and 2003 [@fargo2012]. 

The IVQ system initiated in 1997 referred to for shortraker applies to all species caught in the trawl fishery, including rex sole.

### Data sources

Commercial and fishery data (catch, lengths, weights, ages, maturity) are available for rex sole in DFO databases for analysis as described above for shortraker rockfish. The fishery-independent trawl surveys mentioned above for shortraker have also been capturing and collecting data on rex sole and other flatfish since 2003. There is currently no method for estimating historic catches for rex sole as has been done for rockfish species. 

### US

In the US, rex sole is caught in the bottom trawl fishery and is considered to form three separate stocks: the Gulf of Alaska stock (GOA), the Bering Sea/Aleutian Islands (BSAI) stock and the west coast stock from Washington to California. The GOA stock is assessed every four years using an age-structured model and was last fully assessed in 2017 [@mcgilliard2017]. The BSAI stock is assessed as part of the "other flatfish complex" of which rex sole and starry flounder make up most of the commercial harvest. This stock is also assessed every four years, and was last fully assessed with a random effects model in 2015 [@wilderbuer2015]. The west coast stock was last assessed in 2013 using "extended simple Stock Synthesis" in which a depletion-based stock reduction type analysis is extended to allow index data (and potentially length and age data) to be used for parameter estimation in Stock Synthesis [@cope2015].

<!-- Maturity
Abookire 2006 - GOA ML50 females = 352 mm, ML100 = 420 mm) significantly larger size than in Oregon 
MA50 = 5.1 years, all mature at age 9 except for two still immature at 9 and 10 years (n=557)
Hosie and Horton 1977 - Oregon female ML50 24 cm, ML100 = 30 cm
MA50 = 5 years, MA100 = 9 years (212 females, 45 unsexed age 1 fish)

Mortality
natural mortality used in GOA assessment 0.17-->

## STEP 1: DEFINE THE DECISION CONTEXT {#sec:results-rex1}


## STEP 2: SELECTION OF OBJECTIVES AND PERFORMANCE METRICS  {#sec:results-rex2}



## STEP 3: SELECTION OF UNCERTAINTIES/SPECIFICATION OF OPERATING MODELS {#sec:results-rex3}

*TODO: RF to write this up*

Reference set:

```{r rex-scen, results='asis'}
sc <- readRDS(here::here("generated-data/rex-scenarios.rds"))
sc %>% 
  select(-scenario, -order) %>%
csasdown::csas_table(caption = "Rex Sole scenarios")
``` 



## Conditioning

```{r}

# g1 <- gfdlm::plot_historical_ts(rex_historical, observed_ts = catch) +
#   xlab("")
# g2 <- gfdlm::plot_historical_ts(rex_historical, type = "SSB") +
#   ylab("Historical SSB\n(spawning stock biomass)") +
#   xlab("")
# g3 <- gfdlm::plot_historical_ts(rex_historical, type = "Rec") +
#   ylab("Historical recruitment\n(relative numbers)") +
#   xlab("")
# g4 <- gfdlm::plot_historical_ts(rex_historical, type = "Find") +
#   ylab("Historical F\n(fishing mortality)") +
#   xlab("")
# cowplot::plot_grid(g1, g2, g3, g4, ncol = 2, align = "hv")
```


```{r rex-survey-fits, fig.cap="Survey fits.", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-index-fits.png"))
```

```{r rex-selectivity, fig.cap="Survey fits.", out.width="4in"}
knitr::include_graphics(here::here("report/figure/rex-selectivity.png"))
```

\clearpage

(ref:fig-rex-depletion-om)
SSB depeltion trajectories from reference and robustness set OMs.
Some OMs ("M decreasing" and "M increasing") have identical historical trajectories as "Catch eq. 50%", but with a fixed value of M in the historical period (i.e., the change in M only occurs in the projection period).

```{r rex-depletion-om, fig.cap="(ref:fig-rex-depletion-om)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-compare-SRA-depletion-panel.png"))
```


## STEP 4: IDENTIFICATION OF CANDIDATE MANAGEMENT PROCEDURES  {#sec:results-rex4}



## STEP 5: SIMULATION OF THE APPLICATION OF THE MANAGEMENT PROCEDURES  {#sec:results-rex5}

(ref:fig-rex-converge)
Assessing convergence of the Rex Sole closed-loop simulation under the base OM.
Broad differences between MPs have converged (lines no longer cross each other).
Some MPs with very similar performance may still be exchanging rank order within specific performance metrics as of 200 iterations.
Final inference should probably be drawn on somewhat greater than the 200 iterations shown here.

```{r rex-converge, fig.cap="(ref:fig-rex-converge)", out.width="5in"}
knitr::include_graphics(here::here("report/figure/rex-converge.png"))
```


## STEP 6: PRESENTATION OF RESULTS AND SELECTION OF MANAGEMENT PROCEDURE  {#sec:results-rex6}


### Reference Set Results

*TODO: Average results over all reference set OMs**


### Robustness Set Results

*TODO: Individual sets of results for robustness set OMs*








\clearpage

(ref:fig-rex-tigure) Performance of all candidate MPs for the base OM.
MPs are ordered by decreasing performance metric values from top to bottom starting with the left-most performance metric and using columns from left to right to break any ties.
The color shading reflects the underlying numbers.

```{r rex-tigure, fig.cap="(ref:fig-rex-tigure)", out.width="3.5in"}
knitr::include_graphics(here::here("report/figure/rex-pm-table-base.png"))
```

\clearpage

(ref:fig-rex-proj-ceq50) Historical and projected SSB/SSB~MSY~, F/F~MSY~, and catch across satisficed and reference MPs for the base OM.
Dark line indicates the median value and the darker and lighter shaded ribbons indicate the 50% and 90% quantiles.
Thin gray lines represent illustrative simulation iterations.
The vertical dashed line indicates the last year of the historical period.
The horizontal dashed lines indicate SSB/SSB~MSY~ = 1, 0.8, and 0.4; F/F~MSY~ = 1; and catch = catch from the last historical year.

```{r rex-proj-ceq50, fig.cap="(ref:fig-rex-proj-ceq50)", out.width="6.5in"}
knitr::include_graphics(here::here("report/figure/rex-projections-satisficed-ceq50.png"))
```

\clearpage

(ref:fig-rex-proj-failed) Historical and projected SSB/SSB~MSY~, F/F~MSY~, and catch for the base OM across example MPs that did **not** pass the satisficing criteria. In cases where similar MPs existed but had similar performance, only one is shown as an example (e.g., for .IDX and .IDX_smooth, only .IDX_smooth is shown).
Caption is otherwise the same as Figure \@ref(fig:rex-proj-ceq50).

```{r rex-proj-failed, fig.cap="(ref:fig-rex-proj-failed)", out.width="6.5in"}
knitr::include_graphics(here::here("report/figure/rex-projections-eg-NOT-satisficed-ceq50.png"))
```

\clearpage

(ref:fig-rex-proj-cpue) Historical and projected SSB/SSB~MSY~, F/F~MSY~, and catch across satisficed and reference MPs for the OM with catch equilibrium in 1996 set to 200% of catch in that year and commercial CPUE included as an index. Caption is the same otherwise as Figure \@ref(fig:rex-proj-ceq50).

```{r rex-proj-cpue, fig.cap="(ref:fig-rex-proj-cpue)", out.width="6.5in"}
knitr::include_graphics(here::here("report/figure/rex-projections-satisficed-ceq200-cpue.png"))
```

\clearpage

(ref:fig-rex-tigure-panel) Performance of satisficed MPs for the reference and robustness set OMs.
MPs are ordered by decreasing performance metric values for the base OM "Catch eq. 50%".

```{r rex-tigure-panel, fig.cap="(ref:fig-rex-tigure-panel)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-pm-tigures.png"))
```

\clearpage

```{r rex-spider-all-mps, fig.cap="Spider plots of performance metric trade-offs amongst all MPs for the base OM. Each spoke of the web represents a performance metric and each line represents a management procedure. Lines closer to the outside of the web correspond to MPs that are determined to have a higher probability of achieving that performance metric.", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-spider-all-mptypes-base-panel.png"))
```

\clearpage

(ref:fig-rex-kobe) SSB/SSB~MSY~ and F/F~MSY~ values from the final year of the projections across all iterations. 
Dots represent individual iterations.
Contour lines indicate two-dimensional kernel-density-smoothed quantiles at 0.10, 0.25, and 0.50 levels, calculated in log space.

```{r rex-kobe, fig.cap="(ref:fig-rex-kobe)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-kobe-satisficed-ceq50.png"))
```

\clearpage

(ref:fig-rex-worm) Trajectory of SSB/SSB~MSY~ and F/F~MSY~ values summarized across iterations.
The solid line corresponds to the median value.
Each diamond represents the 80% quantile of B/B~MSY~ (horizontal) and F/F~MSY~ (vertical).

```{r rex-worm, fig.cap="(ref:fig-rex-worm)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-neon-worms-base.png"))
```

\clearpage

```{r rex-spider-base-om, fig.cap="Spider plots of performance metric trade-offs amongst satisficed MPs for the base OM.", out.width="5in"}
knitr::include_graphics(here::here("report/figure/rex-spider-satisficed-ceq50.png"))
```

\clearpage

(ref:fig-rex-spider-all-oms)
Spider plots of performance metric trade-offs amongst satisficed MPs for all OMs. Colours are the same as in Figure \@ref(fig:rex-spider-base-om).

```{r rex-spider-all-oms, fig.cap="(ref:fig-rex-spider-all-oms)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-spider-satisficed-panel.png"))
```

\clearpage

(ref:fig-rex-sens-bbmsy) 
This visualization illustrates the sensitivity of some quantity of interest (y-axis; here mean B/B~MSY~ in years 36--50 of the projection) to OM parameter values (x-axis).
<!-- A variety of MPs are illustrated across rows. -->
<!-- Each point corresponds to simulation iteration and the solid lines correspond to a loess smoother (encompassing a 75% moving window of the data). -->
<!-- For example, the top-left panel illustrates the sensitivity of the MP ".ICI" in terms of the mean B/B~MSY~ in years 36--50 across different values of D (depletion in the final historical year). -->
<!-- For iterations that had a lower value of D (more depleted in the final historical year) there is a wider spread of possible B/B~MSY~ values in years 36--50 (left side of panel). -->
<!-- Iterations that had a higher value of D (right side of panel) have a more consistent B/B~MSY~ in years 36--50. -->
<!-- Note that none of these panels show strong patterns of sensitivity. -->
<!-- Any strong pattern in the points with changes in an OM parameter value highlight that an MP is sensitive to that OM parameter value. -->

```{r rex-sens-bbmsy, fig.cap="(ref:fig-rex-sens-bbmsy)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-sensitivity-bbmsy-base.png"))
```

(ref:fig-rex-sens-yield) 
This visualization illustrates the sensitivity of some quantity of interest (y-axis; here mean yield in years 6-20 of the projection) to OM parameter values (x-axis).

```{r rex-sens-yield, fig.cap="(ref:fig-rex-sens-yield)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-sensitivity-yield-base.png"))
```

\clearpage

(ref:fig-rex-proj-sens) 
This visualization illustrates the sensitivity of some quantity of interest (y-axis; here B/B~MSY~) to high and low values (colors) of various OM parameters (columns) over time.
<!-- A variety of MPs are illustrated across rows. -->
<!-- The solid lines correspond to median values and shaded ribbons correspond to some quantile (here 0.15 and 0.85) to indicate variability across iterations. -->
<!-- For each OM parameter value and MP, the iterations from the top and lower third quantiles have been retained and the middle third has been discarded. -->
<!-- Substantial differences between the trajectories for the two colours would indicate that the quantity of interest is sensitive to high or low values of that OM parameter. -->
<!-- For example, the first column illustrates that all the MPs are somewhat sensitive to depletion in the final historical year in terms of B/B~MSY~. -->

```{r rex-proj-sens-bbmsy, fig.cap="(ref:fig-rex-proj-sens)", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-sensitivity-traj-bbmsy-base.png"))
```

\clearpage

```{r rex-proj-sens-ffmsy, fig.cap="FFmsy", out.width="\\textwidth"}
knitr::include_graphics(here::here("report/figure/rex-sensitivity-traj-ffmsy-base.png"))
```
